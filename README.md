# Microservice to push configuration to Junos device.

## Description

This microservice provides mechanism to deploy configuration to Junos Devices. These configuration files must be generated by any 3rd part solution and will be consume by this container.

__Basic usage__


```shell
# Pull image from docker
% docker pull jnprautomate/junos-deployer

# Create folder structure
% mkdir {inputs,configs,diffs}

# make inventory for ansible
vim inputs/inventory.ini

% docker run -it --rm \
	-v ${PWD}/inputs:/inventory \
	-v ${PWD}/diffs:/outputs \
	-v ${PWD}/configs:/config \
	jnprautomate/junos-deployer:latest
```

## Data management:

__Inputs__

- Ansible Inventory file (inventory.ini) with following elements:
    - `ansible_host`: IP of the device
    - `netconf_port`: netconf port uses to connect to devices (default is 830)
    - `ansible_ssh_private_key`: Private key to use to authenticate against devices (Optional)
    - `ansible_ssh_user`: Username to use for the connection
    - `ansible_ssh_pass`: Password to use for the connection (Optional if private key is configured)
- `commit_mode`: define how configuration management is. done: `merge` or `replace` (optional)
- Configuration folder where all configuration files are stored with this syntax: `{{inventory_hostname}}.conf`

__Outputs__

- Configuration diff for every devices: One file per device (Optional)

__Volumes to mount__

- `inventory`: Folder where inventory file is located
- `config`: Folder where all the configuration files are located
- `outputs`: Optional folder to get access to all diff when configuration are committed.

## Output example

Below is an example of how to use this container

```shell
evpn-microservice ᐅ docker run -it --rm -v ${PWD}/inputs:/inventory -v ${PWD}/diffs:/outputs -v ${PWD}/configs:/config jnprautomate/junos-deployer:latest
Deploy configuration to Junos devices
  > Check inventory file
  > Inventory file found (inputs/inventory.ini)
  > Deploy configurations to devices

PLAY [Deploy configuration] *******************************************************************************************

TASK [include_vars] ***************************************************************************************************
ok: [demo-qfx10k2-14]
ok: [demo-qfx5110-11]
ok: [demo-qfx10k2-15]
ok: [demo-qfx5110-9]
ok: [demo-qfx5110-10]
ok: [demo-qfx5110-12]

TASK [config-deploy-core : Commit Configuration to devices] ***********************************************************
changed: [demo-qfx10k2-14]
changed: [demo-qfx10k2-15]
changed: [demo-qfx5110-10]
changed: [demo-qfx5110-9]
changed: [demo-qfx5110-11]
changed: [demo-qfx5110-12]

PLAY RECAP ************************************************************************************************************
demo-qfx10k2-14            : ok=2    changed=1    unreachable=0    failed=0
demo-qfx10k2-15            : ok=2    changed=1    unreachable=0    failed=0
demo-qfx5110-10            : ok=2    changed=1    unreachable=0    failed=0
demo-qfx5110-11            : ok=2    changed=1    unreachable=0    failed=0
demo-qfx5110-12            : ok=2    changed=1    unreachable=0    failed=0
demo-qfx5110-9             : ok=2    changed=1    unreachable=0    failed=0
```
